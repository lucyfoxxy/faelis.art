---
interface PriceItem {
  name: string;
  price?: number;
  from?: number;
  to?: number;
  unit?: string;
  note?: string;
  link?: string;
}
interface PriceCategory {
  title: string;
  items: PriceItem[];
}
interface PricesData {
  currency?: string;           // z.B. "EUR" oder "USD"
  categories: PriceCategory[];
}

const { prices } = Astro.props as { prices: PricesData };

const currency = prices.currency ?? "EUR";
const fmt = (value?: number) => {
  if (value == null) return "–";
  try { return new Intl.NumberFormat("de-DE", { style: "currency", currency }).format(value); }
  catch { return `${value} ${currency}`; }
};

const formatPrice = (item: PriceItem) => {
  if (item.price != null) return fmt(item.price);
  if (item.from != null && item.to != null) return `${fmt(item.from)} – ${fmt(item.to)}`;
  if (item.from != null) return `ab ${fmt(item.from)}`;
  return "auf Anfrage";
};
---

{prices.categories.map((cat) => (
  <section style="margin-block: 1.5rem">
    <h2 style="margin-bottom:.6rem">{cat.title}</h2>
    <div style="overflow:auto;border-radius:12px">
      <table style="width:100%;border-collapse:separate;border-spacing:0;min-width:480px">
        <thead>
          <tr style="text-align:left;background:var(--tbl-head,#1e1e1e)">
            <th style="padding:.75rem 1rem;border-top-left-radius:12px">Leistung</th>
            <th style="padding:.75rem 1rem">Preis</th>
            <th style="padding:.75rem 1rem;border-top-right-radius:12px">Hinweis</th>
          </tr>
        </thead>
        <tbody>
          {cat.items.map((it, i) => (
            <tr style={`background:${i%2? 'var(--tbl-row,#161616)':'transparent'}`}>
              <td style="padding:.65rem 1rem">
                {it.link ? <a href={it.link} rel="noopener" target="_blank">{it.name}</a> : it.name}
                {it.unit ? <span style="opacity:.7"> &nbsp;/ {it.unit}</span> : null}
              </td>
              <td style="padding:.65rem 1rem;white-space:nowrap">{formatPrice(it)}</td>
              <td style="padding:.65rem 1rem;opacity:.85">{it.note ?? ""}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  </section>
))}
